{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\AbdulRashid\\\\Desktop\\\\pesto\\\\Project\\\\ninja\\\\n7-medicalinventory-fullstack-eta-1-7\\\\src\\\\screens\\\\Checkout\\\\Checkout.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from \"react\";\nimport { Card, Button } from \"react-bootstrap\";\nimport { PDFInvoice } from \"../../common/invoice\";\nimport \"./Checkout.css\";\nimport ls from \"local-storage\";\nimport EmptyState from \"../../components/EmptyState/EmptyState\";\nimport { AUTH_TOKEN } from \"../../localStorage\";\nimport axios from \"axios\";\nimport Loader from \"../../components/Loader/Loader\";\nimport { toast } from \"../../components/Toast/Toast\";\nimport { useHistory } from \"react-router\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst Checkout = () => {\n  _s();\n\n  const [cartData, setCartData] = useState([]);\n  const [totalAmount, setTotalAmount] = useState(0);\n  const [filteredDataForInvoice, setFilteredDataForInvoice] = useState([]);\n  const [isLoading, setIsLoading] = useState(false);\n  const history = useHistory();\n  useEffect(() => {\n    const currentCartData = JSON.parse(ls.get(\"cartData\"));\n\n    if (currentCartData && currentCartData.length > 0) {\n      setCartData(currentCartData);\n    }\n  }, []);\n  useEffect(() => {\n    let currentTotalAmount = 0;\n    cartData.map(item => {\n      currentTotalAmount += item.count * item.sell_price;\n    });\n    setTotalAmount(currentTotalAmount);\n    let filteredData = [];\n\n    for (let i = 0; i < cartData.length; i++) {\n      filteredData.push({\n        quantity: cartData[i].count,\n        description: cartData[i].name,\n        tax: 12,\n        price: cartData[i].sell_price * cartData[i].count\n      });\n    }\n\n    setFilteredDataForInvoice(filteredData);\n  }, [cartData]);\n\n  const getFormattedDate = () => {\n    let todayTime = new Date();\n    let month = todayTime.getMonth() + 1;\n    let day = todayTime.getDate();\n    let year = todayTime.getFullYear();\n    return month + \"/\" + day + \"/\" + year;\n  };\n\n  const invoiceGenerator = () => {\n    const logo = \"https://www.logomoose.com/wp-content/uploads/2013/08/ms_moose.jpg\";\n    const senderDetails = {\n      company: \"Sample Corp\",\n      address: \"Sample Street 123\",\n      zip: \"1234 AB\",\n      city: \"Sampletown\",\n      country: \"Samplecountry\"\n    };\n    const clientDetails = {\n      company: \"Client Corp\",\n      address: \"Clientstreet 456\",\n      zip: \"4567 CD\",\n      city: \"Clientcity\",\n      country: \"Clientcountry\"\n    };\n    const invoiceNumber = \"2021.0001\";\n    const invoiceDate = getFormattedDate();\n    const products = filteredDataForInvoice;\n    const bottomNotice = \"Please visit again. Thank you.\";\n    PDFInvoice(logo, senderDetails, clientDetails, invoiceNumber, invoiceDate, products, bottomNotice);\n    setIsLoading(false);\n    setCartData([]);\n    ls.remove(\"cartData\"); // history.goBack()\n  };\n\n  const decrementCountHandler = async item => {\n    let copyData = { ...item\n    };\n\n    if (copyData.count > 1) {\n      copyData.count = copyData.count - 1;\n      let filteredDdata = cartData.filter(cartItem => cartItem.id !== item.id);\n      await filteredDdata.push(copyData);\n      await setCartData(filteredDdata);\n      await ls.remove(\"cartData\");\n      await ls.set(\"cartData\", JSON.stringify(filteredDdata));\n    }\n  };\n\n  const incrementCountHandler = async item => {\n    let copyData = { ...item\n    };\n    copyData.count = copyData.count + 1;\n    let filteredDdata = cartData.filter(cartItem => cartItem.id !== item.id);\n    await filteredDdata.push(copyData);\n    await setCartData(filteredDdata);\n    await ls.remove(\"cartData\");\n    await ls.set(\"cartData\", JSON.stringify(filteredDdata));\n  };\n\n  const removeOrderHandler = async item => {\n    let lsData = JSON.parse(ls.get(\"cartData\"));\n    let filteredData = lsData.filter(lsItem => lsItem.id !== item.id);\n    setCartData(filteredData);\n    await ls.remove(\"cartData\");\n    await ls.set(\"cartData\", JSON.stringify(filteredData));\n  };\n\n  const checkMedicineAvailability = () => {\n    setIsLoading(true);\n    let filteredData = [];\n\n    for (let i = 0; i < cartData.length; i++) {\n      filteredData.push({\n        id: cartData[i].id,\n        qty: cartData[i].count\n      });\n    }\n\n    let config = {\n      headers: {\n        Authorization: `Token ${AUTH_TOKEN}`\n      }\n    };\n    axios.post(\"http://abdulrashidalaskar.pythonanywhere.com/api/order/\", {\n      medicines: filteredData\n    }, config).then(response => {\n      invoiceGenerator();\n      console.log(response);\n    }).catch(error => {\n      toast.error(\"Medicine out of stock!\");\n      setIsLoading(false);\n      console.log(error);\n    });\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"checkout-page-wrapper\",\n    children: isLoading ? /*#__PURE__*/_jsxDEV(Loader, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 157,\n      columnNumber: 9\n    }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: cartData && cartData.length > 0 ? /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"order-summary-wrapper\",\n          children: \"Order Summary\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 162,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"products-wrapper\",\n          children: \"PRODUCTS\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 163,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"checkout-page-content-wrapper\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex-1\",\n            children: /*#__PURE__*/_jsxDEV(Card, {\n              className: \"margin-bottom-12\",\n              children: /*#__PURE__*/_jsxDEV(Card.Body, {\n                children: cartData.map(item => /*#__PURE__*/_jsxDEV(\"section\", {\n                  className: \"medicine-card-wrapper\",\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"flex-content-sb\",\n                    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                      className: \"flex-column\",\n                      children: /*#__PURE__*/_jsxDEV(\"span\", {\n                        className: \"font-weight-700\",\n                        children: item.name\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 172,\n                        columnNumber: 31\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 171,\n                      columnNumber: 29\n                    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                      className: \"checkout-price\",\n                      children: [\"Rs. \", item.sell_price * Number(item.count)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 180,\n                      columnNumber: 29\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 170,\n                    columnNumber: 27\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"checkout-page--counter-wrapper\",\n                    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                      className: \"checkout-counter--wrapper\",\n                      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                        className: \"increment-decrement-counter-wrapper\",\n                        onClick: () => {\n                          decrementCountHandler(item);\n                        },\n                        children: \"-\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 187,\n                        columnNumber: 31\n                      }, this), \"\\xA0\", /*#__PURE__*/_jsxDEV(\"div\", {\n                        className: \"checkout-page--counter-value\",\n                        children: item.count\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 196,\n                        columnNumber: 31\n                      }, this), \"\\xA0\", /*#__PURE__*/_jsxDEV(\"div\", {\n                        className: \"increment-decrement-counter-wrapper\",\n                        onClick: () => {\n                          incrementCountHandler(item);\n                        },\n                        children: \"+\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 200,\n                        columnNumber: 31\n                      }, this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 186,\n                      columnNumber: 29\n                    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                      children: /*#__PURE__*/_jsxDEV(Button, {\n                        variant: \"secondary\",\n                        size: \"sm\",\n                        onClick: () => {\n                          removeOrderHandler(item);\n                        },\n                        children: \"Remove\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 210,\n                        columnNumber: 31\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 209,\n                      columnNumber: 29\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 185,\n                    columnNumber: 27\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 169,\n                  columnNumber: 25\n                }, this))\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 167,\n                columnNumber: 21\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 166,\n              columnNumber: 19\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 165,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"checkout-payment-details\",\n            children: /*#__PURE__*/_jsxDEV(Card, {\n              children: /*#__PURE__*/_jsxDEV(Card.Body, {\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"opacity-6\",\n                  children: \"PAYMENT DETAILS\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 229,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"total-amount\",\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    children: \"Total Amount *\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 231,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    children: [\"Rs. \", totalAmount]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 232,\n                    columnNumber: 25\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 230,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"total-amoount-wrapper\",\n                  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"flex-column\",\n                    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                      className: \"total-amount-wrapper\",\n                      children: \"TOTAL AMOUNT\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 237,\n                      columnNumber: 27\n                    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                      className: \"font-weight-bold\",\n                      children: [\"Rs. \", totalAmount]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 240,\n                      columnNumber: 27\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 236,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    children: /*#__PURE__*/_jsxDEV(Button, {\n                      className: \"checkout-proceed-button\",\n                      onClick: () => {\n                        checkMedicineAvailability();\n                      },\n                      children: \"DOWNLOAD INVOICE\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 245,\n                      columnNumber: 27\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 244,\n                    columnNumber: 25\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 235,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 228,\n                columnNumber: 21\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 227,\n              columnNumber: 19\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 226,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 164,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true) : /*#__PURE__*/_jsxDEV(EmptyState, {\n        actions: /*#__PURE__*/_jsxDEV(\"h5\", {\n          className: \"empty-state-cart\",\n          children: \"Please add a medicine to cart\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 263,\n          columnNumber: 17\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 261,\n        columnNumber: 13\n      }, this)\n    }, void 0, false)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 155,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Checkout, \"cHg39ulvB353VeYLDRP1fWC6xSs=\", false, function () {\n  return [useHistory];\n});\n\n_c = Checkout;\nexport default Checkout;\n\nvar _c;\n\n$RefreshReg$(_c, \"Checkout\");","map":{"version":3,"sources":["C:/Users/AbdulRashid/Desktop/pesto/Project/ninja/n7-medicalinventory-fullstack-eta-1-7/src/screens/Checkout/Checkout.js"],"names":["React","useState","useEffect","Card","Button","PDFInvoice","ls","EmptyState","AUTH_TOKEN","axios","Loader","toast","useHistory","Checkout","cartData","setCartData","totalAmount","setTotalAmount","filteredDataForInvoice","setFilteredDataForInvoice","isLoading","setIsLoading","history","currentCartData","JSON","parse","get","length","currentTotalAmount","map","item","count","sell_price","filteredData","i","push","quantity","description","name","tax","price","getFormattedDate","todayTime","Date","month","getMonth","day","getDate","year","getFullYear","invoiceGenerator","logo","senderDetails","company","address","zip","city","country","clientDetails","invoiceNumber","invoiceDate","products","bottomNotice","remove","decrementCountHandler","copyData","filteredDdata","filter","cartItem","id","set","stringify","incrementCountHandler","removeOrderHandler","lsData","lsItem","checkMedicineAvailability","qty","config","headers","Authorization","post","medicines","then","response","console","log","catch","error","Number"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport { Card, Button } from \"react-bootstrap\";\r\nimport { PDFInvoice } from \"../../common/invoice\";\r\nimport \"./Checkout.css\";\r\nimport ls from \"local-storage\";\r\nimport EmptyState from \"../../components/EmptyState/EmptyState\";\r\nimport { AUTH_TOKEN } from \"../../localStorage\";\r\nimport axios from \"axios\";\r\nimport Loader from \"../../components/Loader/Loader\";\r\nimport { toast } from \"../../components/Toast/Toast\";\r\nimport { useHistory } from \"react-router\";\r\n\r\nconst Checkout = () => {\r\n  const [cartData, setCartData] = useState([]);\r\n  const [totalAmount, setTotalAmount] = useState(0);\r\n  const [filteredDataForInvoice, setFilteredDataForInvoice] = useState([]);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const history = useHistory()\r\n  useEffect(() => {\r\n    const currentCartData = JSON.parse(ls.get(\"cartData\"));\r\n    if (currentCartData && currentCartData.length > 0) {\r\n      setCartData(currentCartData);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    let currentTotalAmount = 0;\r\n    cartData.map((item) => {\r\n      currentTotalAmount += item.count * item.sell_price;\r\n    });\r\n\r\n    setTotalAmount(currentTotalAmount);\r\n\r\n    let filteredData = [];\r\n    for (let i = 0; i < cartData.length; i++) {\r\n      filteredData.push({\r\n        quantity: cartData[i].count,\r\n        description: cartData[i].name,\r\n        tax: 12,\r\n        price: cartData[i].sell_price * cartData[i].count,\r\n      });\r\n    }\r\n    setFilteredDataForInvoice(filteredData);\r\n  }, [cartData]);\r\n\r\n  const getFormattedDate = () => {\r\n    let todayTime = new Date();\r\n\r\n    let month = todayTime.getMonth() + 1;\r\n    let day = todayTime.getDate();\r\n    let year = todayTime.getFullYear();\r\n    return month + \"/\" + day + \"/\" + year;\r\n  };\r\n\r\n  const invoiceGenerator = () => {\r\n    const logo =\r\n      \"https://www.logomoose.com/wp-content/uploads/2013/08/ms_moose.jpg\";\r\n    const senderDetails = {\r\n      company: \"Sample Corp\",\r\n      address: \"Sample Street 123\",\r\n      zip: \"1234 AB\",\r\n      city: \"Sampletown\",\r\n      country: \"Samplecountry\",\r\n    };\r\n    const clientDetails = {\r\n      company: \"Client Corp\",\r\n      address: \"Clientstreet 456\",\r\n      zip: \"4567 CD\",\r\n      city: \"Clientcity\",\r\n      country: \"Clientcountry\",\r\n    };\r\n    const invoiceNumber = \"2021.0001\";\r\n    const invoiceDate = getFormattedDate();\r\n    const products = filteredDataForInvoice;\r\n    const bottomNotice = \"Please visit again. Thank you.\";\r\n    PDFInvoice(\r\n      logo,\r\n      senderDetails,\r\n      clientDetails,\r\n      invoiceNumber,\r\n      invoiceDate,\r\n      products,\r\n      bottomNotice\r\n    );\r\n    setIsLoading(false);\r\n    setCartData([]);\r\n    ls.remove(\"cartData\");\r\n    // history.goBack()\r\n  };\r\n\r\n  const decrementCountHandler = async (item) => {\r\n    let copyData = { ...item };\r\n    if (copyData.count > 1) {\r\n      copyData.count = copyData.count - 1;\r\n      let filteredDdata = cartData.filter(\r\n        (cartItem) => cartItem.id !== item.id\r\n      );\r\n      await filteredDdata.push(copyData);\r\n      await setCartData(filteredDdata);\r\n      await ls.remove(\"cartData\");\r\n      await ls.set(\"cartData\", JSON.stringify(filteredDdata));\r\n    }\r\n  };\r\n\r\n  const incrementCountHandler = async (item) => {\r\n    let copyData = { ...item };\r\n    copyData.count = copyData.count + 1;\r\n    let filteredDdata = cartData.filter((cartItem) => cartItem.id !== item.id);\r\n    await filteredDdata.push(copyData);\r\n    await setCartData(filteredDdata);\r\n    await ls.remove(\"cartData\");\r\n    await ls.set(\"cartData\", JSON.stringify(filteredDdata));\r\n  };\r\n\r\n  const removeOrderHandler = async (item) => {\r\n    let lsData = JSON.parse(ls.get(\"cartData\"));\r\n    let filteredData = lsData.filter((lsItem) => lsItem.id !== item.id);\r\n\r\n    setCartData(filteredData);\r\n    await ls.remove(\"cartData\");\r\n    await ls.set(\"cartData\", JSON.stringify(filteredData));\r\n  };\r\n\r\n  const checkMedicineAvailability = () => {\r\n    setIsLoading(true);\r\n    let filteredData = [];\r\n    for (let i = 0; i < cartData.length; i++) {\r\n      filteredData.push({ id: cartData[i].id, qty: cartData[i].count });\r\n    }\r\n\r\n    let config = {\r\n      headers: {\r\n        Authorization: `Token ${AUTH_TOKEN}`,\r\n      },\r\n    };\r\n\r\n    axios\r\n      .post(\r\n        \"http://abdulrashidalaskar.pythonanywhere.com/api/order/\",\r\n        { medicines: filteredData },\r\n        config\r\n      )\r\n      .then((response) => {\r\n        invoiceGenerator();\r\n        console.log(response);\r\n      })\r\n      .catch((error) => {\r\n        toast.error(\"Medicine out of stock!\");\r\n        setIsLoading(false);\r\n        console.log(error);\r\n      });\r\n  };\r\n\r\n  return (\r\n    <div className=\"checkout-page-wrapper\">\r\n      {isLoading ? (\r\n        <Loader />\r\n      ) : (\r\n        <>\r\n          {cartData && cartData.length > 0 ? (\r\n            <>\r\n              <div className=\"order-summary-wrapper\">Order Summary</div>\r\n              <div className=\"products-wrapper\">PRODUCTS</div>\r\n              <div className=\"checkout-page-content-wrapper\">\r\n                <div className=\"flex-1\">\r\n                  <Card className=\"margin-bottom-12\">\r\n                    <Card.Body>\r\n                      {cartData.map((item) => (\r\n                        <section className=\"medicine-card-wrapper\">\r\n                          <div className=\"flex-content-sb\">\r\n                            <div className=\"flex-column\">\r\n                              <span className=\"font-weight-700\">\r\n                                {item.name}\r\n                              </span>\r\n                              {/* <span className=\"tablets-strip\">\r\n                          strip of 15 tablets\r\n                        </span> */}\r\n                            </div>\r\n\r\n                            <div className=\"checkout-price\">\r\n                              Rs. {item.sell_price * Number(item.count)}\r\n                            </div>\r\n                          </div>\r\n\r\n                          <div className=\"checkout-page--counter-wrapper\">\r\n                            <div className=\"checkout-counter--wrapper\">\r\n                              <div\r\n                                className=\"increment-decrement-counter-wrapper\"\r\n                                onClick={() => {\r\n                                  decrementCountHandler(item);\r\n                                }}\r\n                              >\r\n                                -\r\n                              </div>\r\n                              &nbsp;\r\n                              <div className=\"checkout-page--counter-value\">\r\n                                {item.count}\r\n                              </div>\r\n                              &nbsp;\r\n                              <div\r\n                                className=\"increment-decrement-counter-wrapper\"\r\n                                onClick={() => {\r\n                                  incrementCountHandler(item);\r\n                                }}\r\n                              >\r\n                                +\r\n                              </div>\r\n                            </div>\r\n                            <div>\r\n                              <Button\r\n                                variant=\"secondary\"\r\n                                size=\"sm\"\r\n                                onClick={() => {\r\n                                  removeOrderHandler(item);\r\n                                }}\r\n                              >\r\n                                Remove\r\n                              </Button>\r\n                            </div>\r\n                          </div>\r\n                        </section>\r\n                      ))}\r\n                    </Card.Body>\r\n                  </Card>\r\n                </div>\r\n                <div className=\"checkout-payment-details\">\r\n                  <Card>\r\n                    <Card.Body>\r\n                      <div className=\"opacity-6\">PAYMENT DETAILS</div>\r\n                      <div className=\"total-amount\">\r\n                        <div>Total Amount *</div>\r\n                        <div>Rs. {totalAmount}</div>\r\n                      </div>\r\n\r\n                      <div className=\"total-amoount-wrapper\">\r\n                        <div className=\"flex-column\">\r\n                          <div className=\"total-amount-wrapper\">\r\n                            TOTAL AMOUNT\r\n                          </div>\r\n                          <div className=\"font-weight-bold\">\r\n                            Rs. {totalAmount}\r\n                          </div>\r\n                        </div>\r\n                        <div>\r\n                          <Button\r\n                            className=\"checkout-proceed-button\"\r\n                            onClick={() => {\r\n                              checkMedicineAvailability();\r\n                            }}\r\n                          >\r\n                            DOWNLOAD INVOICE\r\n                          </Button>\r\n                        </div>\r\n                      </div>\r\n                    </Card.Body>\r\n                  </Card>\r\n                </div>\r\n              </div>\r\n            </>\r\n          ) : (\r\n            <EmptyState\r\n              actions={\r\n                <h5 className=\"empty-state-cart\">\r\n                  Please add a medicine to cart\r\n                </h5>\r\n              }\r\n            />\r\n          )}\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Checkout;"]},"metadata":{},"sourceType":"module"}